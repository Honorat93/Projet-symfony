{% extends 'base.html.twig' %}

{% block title %}Accueil des Devis{% endblock %}

{% block stylesheets %}
<style>
    .icon-sm {
        width: 1em;
        height: 1em;
        vertical-align: middle;
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ ux_icon('bi:file-earmark-text', { class: 'icon-sm' }) }} Liste des Devis</h1>
        <div>
            <a href="{{ path('quote_create') }}" class="btn btn-success me-2">
                {{ ux_icon('bi:plus-circle', { class: 'icon-sm' }) }} Créer un Devis
            </a>
            <a href="{{ path('web_homepage') }}" class="btn btn-secondary">
                {{ ux_icon('bi:house-door', { class: 'icon-sm' }) }} Retour à l'Accueil
            </a>
        </div>
    </div>

    <div class="row">
        {% if quotes is empty %}
            <p>Aucun devis disponible.</p>
        {% else %}
            {% for quote in quotes %}
                <div class="col-12 mb-3">
                    <div class="card p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Devis #{{ quote.id }}</strong> - {{ quote.title ?? 'Sans titre' }}
                            </div>
                            <div>
                                {% if is_granted('QUOTE_MANAGE', quote) %}
                                    <button onclick="window.location.href='{{ path('quote_update', {'id': quote.id}) }}'" class="btn btn-sm btn-primary me-1">
                                        {{ ux_icon('bi:pencil-square', { class: 'icon-sm' }) }} Modifier
                                    </button>

                                    <form method="POST" action="{{ path('delete_quote', { id: quote.id }) }}" style="display:inline;" onsubmit="return confirm('Supprimer ce devis ?');">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete-quote-' ~ quote.id) }}">
                                        <button type="submit" class="btn btn-sm btn-danger">
                                            {{ ux_icon('bi:trash', { class: 'icon-sm' }) }} Supprimer
                                        </button>
                                    </form>
                                {% endif %}

                                <button onclick="window.location.href='{{ path('read_quote', {'id': quote.id}) }}'" class="btn btn-sm btn-secondary ms-2">
                                    {{ ux_icon('bi:eye', { class: 'icon-sm' }) }} Lire
                                </button>
                                <a href="{{ path('download_quote_pdf', {'id': quote.id}) }}" class="btn btn-sm btn-success ms-2" target="_blank">
                                    {{ ux_icon('bi:download', { class: 'icon-sm' }) }} Télécharger
                                </a>

                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}
